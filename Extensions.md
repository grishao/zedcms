# Расширения ZedCMS #

Иногда необходимо внедрить свой код в стандартные классы фреймворка. Например, получить управления сразу после запуска фреймворка, или после создания пользователя. Для этого служат расширения.

# Концепция #
Так как вся логика работы сосредоточена в библиотеках, расширения работают именно с ними. То есть можно расширить или внедриться в методы стандартных библиотек (классов) ZedCMS.

Расширения устроены таким образом, что могут быть внедрены в начале какого либо метода (**before**), либо в конце(**after**). Например, у нас есть метод **Z\_User::registerNewUser**, который вызывается каждый раз, когда фреймворк регистрирует нового пользователя. И для этого метода существует свое расширение **before** и **after**, таким образом, мы можем вызвать свой код до непосредственной регистрации пользователя или после.

Расширения состоят из трех частей:
  * **Определение**
  * **Вызов**
  * **Имплементация**

# Определение #
Определения расширений находятся в файле **/z.common/extensions/definitions.php**, они нужны для справочной информации, какие расширения доступны во фреймворке на данный момент. В определениях указан класс с методом, который может быть расширен.

# Вызов #
Вызов расширения происходит внутри стандартной библиотеки. Если нет вызова расширения, не будет возможности самого расширения.

**Внимание!** Если вам необходимо расширить какой либо стандартный метод фреймворка, не правьте сам файл фреймворка, отправьте запрос на добавление необходимого расширения на email aleh.hryshanovich@gmail.com и оно будет оперативно добавлено.

# Имплементация #
Имплементация - это код расширения, который будет вызван в месте, к которому он привязан.

Имплементация задается в файле **/extensions/implementations.php**. Вот пример создания имплементации:
```
<?
$implementations=array(
    "Z_Application::Start.after" => array(
        array("call_function" => "Mysite_Loader::onStartApplication")
    )
);
?>
```

А вот сам код имплементации:
```
<?
class Mysite_Loader {
    static function onStartApplication() {
        global $DB_BITRIX;
        $DB_BITRIX = new Z_DB(Z_Application::$config["db.bitrix.server"],Z_Application::$config["db.bitrix.user"],Z_Application::$config["db.bitrix.password"],Z_Application::$config["db.bitrix.db"]);
    }
}
?>
```

В результате на старте фреймворка будет создана глобальная переменная **$DB\_BITRIX** с дополнительным соединением к БД Битрикса, параметры подключения которой должны быть заданы в [конфигурации сайта](SiteConfiguration.md).

В расширениях можно писать любую логику, однако стоит учитывать, куда внедряется расширение и как часто оно будет вызываться, чтобы не вызвать замедление работы сайта.