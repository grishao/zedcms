# Трехландшафтная архитектура #
Для разработки больших проектов, часто применяется трехландшафтная архитектура.

Это означает, что ваш сайт будет иметь три копии, одна для разработки, вторая для тестирования и третяя для продуктивной эксплуатации. Каждая из них будет доступна на своем домене или поддомене, например:
  * dev.site1.com
  * test.site1.com
  * www.site1.com

Более того, можно не ограничиваться всего тремя копиями, а сделать, например, 3 копии для разработки, тем самым организовав возможность ведения трех независимых разработок, которые в итоге сольются сначала в тесте, а потом перенесутся в продуктив.

Сами копии можно хранить на разных серверах, для безопасности и оптимизации ресурсов. Например, продуктивную версию можно вынести в отдельный мощный сервер, а остальные копии держать на сервере разработок.

# Как лучше организовать работу #
Для удоства разработчиков можно организовать FTP доступ к копии разработки, тем самым разработчик может напрямую редактировать код на сервере разработки сайта dev.site1.com и сразу же по этому URL видеть свои изменения. При этом ему не надо вникать в транспортную систему, систему контроля версий, не надо иметь настроеное окружение (веб сервер и сервер БД) и скачивать весь проект к себе на компьютер. Более того, с помощью FTP можно ограничить доступ только к определенным файлам.

Все что нужно разработчику, это IDE, который позволяет редактировать файлы напрямую через FTP и браузер в котором он будет видеть изменения. Примером такого IDE является [PhpED от NuSphere](http://www.nusphere.com/products/phped.htm).

# Транспортная система #
Имея три и более копий сайта, необходимо иметь возможность быстрого переноса изменений от одной копии к другой. Классический маршрут транспорта изменений:
  * от копии разработки в копию тестирования
  * от копии тестирования в копию продуктива

Для организации транспорта можно использовать любую систему контроля версий, которая позволяет переносить код от одного репозитария в другой. При разработке фреймворка ZedCMS в качестве системы контроля версий был выбран **Git** с одной веткой **master**.

Для обмена изменениями между экземплярами сайтов был введен центральный репозитарий, который может лежать на сервере в недоступной извне папки, или на каком либо хостинге, например в code.google.com или github.com.

В каждом экземпляре сайта (разработка, тестирование или продуктивная копия) имеется развернутый git проект, оригиналом которого является центральный репозитарий, и все транспорты производятся через центральный репозитарий. Напоминаем, что **в git будет использована только одна ветка master**.

# Направление движения изменений #
Рассмотрим пример, транспорта изменений от сайта разработки к продуктивному сайту.

  1. после завершения разработки на сайте разработки делается commit и push в центральный репозитарий.
  1. далее делается pull на сайте теста из центрального репозитария.
  1. после выявления багов, производятся изменения на сайте разработки и вновь повторяются 1-ый и 2-ой шаги.
  1. в случае успешного тестирования, производится pull с центрального репозитария (там будет всегда копия теста) в продуктивный сайт.

# Упрощенная схема #

Можно упростить систему транспорта, исключив из ландшафта тестовый сайт, в итоге будет только разработка и продуктив.

В этом случае тестрование будет проходить прямо на сайте разработки, но при этом необходимо следить, чтобы никто из разработчиков не вносил изменения во время теста. При малых командах или единственном разработчике - это удобнее, так как не надо делать лишних транспортов от разработки до теста. А транспорт в продуктив будет производится прямо из центрального репозитария, куда можно будет делать push изменений только оттестированных разработок.

# Полномочия управления транспортом #
Транспорты, как правило, производятся напрямую на сервере, ответственным лицом. То есть разработчики не имеют возможности запускать транспортную систему, так как они имеют только FTP доступ к одной из копий разработок.

# При наличии нескольких веток разработок #
Если у вас имеется несколько независимых разработок, логично вести их на отдельных доменах/сайтах. В это случае транспортная система немного усложнится.

В упрощенной схеме, описанной выше, решением будет таким же, только при push изменений в центральный репозитарий могут происходить коллизии, если там уже находятся изменения с соседней разработки. В этом случае необходимо производить слияние изменений на текущем сайте разработки, затем повторно тестировать и заново отправлять на центральный репозитарий. Транспорт от центрального репозитария в продуктивную версию сайта останется без изменений.

При наличии отдельного сайта тестирования, можно пойти двумя путями.
  1. Иметь тестовый сайт, который будет обновляться напрямую из сайтов разработки, и отправлять изменения в центральный репозитарий в случае успешного тестирования.
  1. Создать отдельные ветки разработки в **git**, которые будут направляться в центральный репозитарий и затем на тестовый сервер. При необходимости транспорта изменений в продуктив, нужно будет слить ветку разработки с master веткой и затем отправить результат на центральный репозитарий.

При этом транспорт с центрального репозитария в продуктив останется без изменений.

# Гибридная схема #
Так же можно организовать работу в гибридном варианте, например, иметь сайт разработки для быстрого устранения ошибок или оперативного внесения изменений, который будет без тестовой части и будет напрямую отправлять изменения в центральный репозитарий, откуда изменения будут уходить в продуктив.

И в тоже время параллельно будут существовать сайты разработок с тестовым сайтом, для более долгих разработок.